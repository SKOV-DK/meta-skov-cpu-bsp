From: Michael Grzeschik <m.grzeschik@pengutronix.de>
Date: Mon, 11 Apr 2016 14:27:44 +0200
Subject: [PATCH] mdio-bitbang: add SMI0 mode support

Signed-off-by: Michael Grzeschik <m.grzeschik@pengutronix.de>
---
 drivers/net/phy/mdio-bitbang.c | 4 ++++
 include/linux/phy.h            | 2 ++
 2 files changed, 6 insertions(+)

diff --git a/drivers/net/phy/mdio-bitbang.c b/drivers/net/phy/mdio-bitbang.c
index 61a543c788cc..b118236cc7e4 100644
--- a/drivers/net/phy/mdio-bitbang.c
+++ b/drivers/net/phy/mdio-bitbang.c
@@ -160,6 +160,8 @@ static int mdiobb_read(struct mii_bus *bus, int phy, int reg)
 	if (reg & MII_ADDR_C45) {
 		reg = mdiobb_cmd_addr(ctrl, phy, reg);
 		mdiobb_cmd(ctrl, MDIO_C45_READ, phy, reg);
+	} else if (reg & MII_ADDR_SMI0) {
+		mdiobb_cmd(ctrl, 0, phy, reg);
 	} else
 		mdiobb_cmd(ctrl, MDIO_READ, phy, reg);
 
@@ -191,6 +193,8 @@ static int mdiobb_write(struct mii_bus *bus, int phy, int reg, u16 val)
 	if (reg & MII_ADDR_C45) {
 		reg = mdiobb_cmd_addr(ctrl, phy, reg);
 		mdiobb_cmd(ctrl, MDIO_C45_WRITE, phy, reg);
+	} else if (reg & MII_ADDR_SMI0) {
+		mdiobb_cmd(ctrl, 0, phy, reg);
 	} else
 		mdiobb_cmd(ctrl, MDIO_WRITE, phy, reg);
 
diff --git a/include/linux/phy.h b/include/linux/phy.h
index 05fde31b6dc6..97e33c4f192e 100644
--- a/include/linux/phy.h
+++ b/include/linux/phy.h
@@ -146,6 +146,8 @@ static inline const char *phy_modes(phy_interface_t interface)
    IEEE 802.3ae clause 45 addressing mode used by 10GIGE phy chips. */
 #define MII_ADDR_C45 (1<<30)
 
+#define MII_ADDR_SMI0 (1<<31)
+
 struct device;
 struct sk_buff;
 
