From: Michael Grzeschik <m.grzeschik@pengutronix.de>
Date: Wed, 10 Oct 2018 12:36:15 +0200
Subject: [PATCH] dsa: ksz: add test_cnt option for ethtool test options

Signed-off-by: Michael Grzeschik <m.grzeschik@pengutronix.de>
---
 drivers/net/dsa/microchip/ksz_common.c | 12 +++++++++---
 drivers/net/dsa/microchip/ksz_priv.h   |  2 ++
 2 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/drivers/net/dsa/microchip/ksz_common.c b/drivers/net/dsa/microchip/ksz_common.c
index 0589fc7ad09e..658b8a694990 100644
--- a/drivers/net/dsa/microchip/ksz_common.c
+++ b/drivers/net/dsa/microchip/ksz_common.c
@@ -158,10 +158,16 @@ int ksz_sset_count(struct dsa_switch *ds, int port, int sset)
 {
 	struct ksz_device *dev = ds->priv;
 
-	if (sset != ETH_SS_STATS)
-		return 0;
+	switch (sset) {
+	case ETH_SS_STATS:
+		return dev->mib_cnt;
+		break;
+	case ETH_SS_TEST:
+		return dev->test_cnt;
+		break;
+	}
 
-	return dev->mib_cnt;
+	return -EINVAL;
 }
 EXPORT_SYMBOL_GPL(ksz_sset_count);
 
diff --git a/drivers/net/dsa/microchip/ksz_priv.h b/drivers/net/dsa/microchip/ksz_priv.h
index 1d2d98f35bb0..2b69cc199dad 100644
--- a/drivers/net/dsa/microchip/ksz_priv.h
+++ b/drivers/net/dsa/microchip/ksz_priv.h
@@ -77,6 +77,8 @@ struct ksz_device {
 	phy_interface_t interface;
 	u32 regs_size;
 
+	int test_cnt;
+
 	struct vlan_table *vlan_cache;
 
 	u8 *txbuf;
