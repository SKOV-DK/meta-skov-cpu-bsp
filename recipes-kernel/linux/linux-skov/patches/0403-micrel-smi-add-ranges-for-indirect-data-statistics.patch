From: Michael Grzeschik <m.grzeschik@pengutronix.de>
Date: Thu, 14 Apr 2016 17:01:08 +0200
Subject: [PATCH] micrel-smi: add ranges for indirect data statistics

Signed-off-by: Michael Grzeschik <m.grzeschik@pengutronix.de>
---
 drivers/net/phy/micrel-smi.c | 35 +++++++++++++++++++++++++++++++++++
 drivers/net/phy/micrel-smi.h |  4 ++++
 2 files changed, 39 insertions(+)

diff --git a/drivers/net/phy/micrel-smi.c b/drivers/net/phy/micrel-smi.c
index 143a1ecb16b3..2b44e61e7e87 100644
--- a/drivers/net/phy/micrel-smi.c
+++ b/drivers/net/phy/micrel-smi.c
@@ -89,6 +89,39 @@ static int micrel_ksz8873_write(void *context, const void *data, size_t count)
 	return 0;
 }
 
+static const struct regmap_range_cfg ksz8873_ranges[] = {
+	{
+		.name = "Static MAC Table",
+		.range_min = REG_SAT_BASE,
+		.range_max = REG_SAT_BASE + 0x08,
+		.selector_reg = REG_IND_IACR0,
+		.selector_mask = 0xff,
+		.selector_shift = 0x0,
+		.window_start = REG_SAT_BASE,
+		.window_len = 0x8,
+	},
+	{
+		.name = "VLAN Table",
+		.range_min = REG_VLAN_BASE,
+		.range_max = REG_VLAN_BASE + 0x08,
+		.selector_reg = REG_IND_IACR0,
+		.selector_mask = 0xff,
+		.selector_shift = 0x0,
+		.window_start = REG_VLAN_BASE,
+		.window_len = 0x3,
+	},
+	{
+		.name = "Dynamic MAC Table",
+		.range_min = REG_DAT_BASE,
+		.range_max = REG_DAT_BASE + 0x08,
+		.selector_reg = REG_IND_IACR0,
+		.selector_mask = 0xff,
+		.selector_shift = 0x0,
+		.window_start = REG_DAT_BASE,
+		.window_len = 0x8,
+	}
+};
+
 static struct regmap_bus micrel_ksz8873_bus = {
 	.read = micrel_ksz8873_read,
 	.write = micrel_ksz8873_write,
@@ -107,6 +140,8 @@ static struct regmap_config micrel_ksz8873_regmap_config = {
 	.reg_stride = 1,
 	.cache_type = REGCACHE_RBTREE,
 	.writeable_reg = micrel_ksz8873_writeable_reg,
+	.ranges = ksz8873_ranges,
+	.num_ranges = ARRAY_SIZE(ksz8873_ranges),
 	.name = "micrel-ksz8873",
 };
 
diff --git a/drivers/net/phy/micrel-smi.h b/drivers/net/phy/micrel-smi.h
index 92eedad648ba..7d28c44c9f94 100644
--- a/drivers/net/phy/micrel-smi.h
+++ b/drivers/net/phy/micrel-smi.h
@@ -356,6 +356,10 @@
 #define REG_PORT_1_WFQ0            0xB2        /* Port1 TXQ Split - Q0 */
 #define   PORT_QUEUE_WFQ             (1 << 7 )    /* enable queue WFQ */
 
+#define REG_SAT_BASE			0xd0
+#define REG_VLAN_BASE			0xe0
+#define REG_DAT_BASE			0xf0
+
 /* Port1 WFQ offset */
 #define QOS_WFQ_ADDR(port, queue, addr)		\
 {														\
