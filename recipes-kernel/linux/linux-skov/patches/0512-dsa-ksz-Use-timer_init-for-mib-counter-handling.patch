From: Michael Grzeschik <m.grzeschik@pengutronix.de>
Date: Mon, 24 Sep 2018 09:20:44 +0200
Subject: [PATCH] dsa: ksz: Use timer_init for mib counter handling

Signed-off-by: Michael Grzeschik <m.grzeschik@pengutronix.de>
---
 drivers/net/dsa/microchip/ksz_common.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/net/dsa/microchip/ksz_common.c b/drivers/net/dsa/microchip/ksz_common.c
index 5201c0f0d5e0..62c07d68acff 100644
--- a/drivers/net/dsa/microchip/ksz_common.c
+++ b/drivers/net/dsa/microchip/ksz_common.c
@@ -99,9 +99,9 @@ static void ksz_mib_read_work(struct work_struct *work)
 	}
 }
 
-static void mib_monitor(unsigned long ptr)
+static void mib_monitor(struct timer_list *t)
 {
-	struct ksz_device *dev = (struct ksz_device *)ptr;
+	struct ksz_device *dev = from_timer(dev, t, mib_read_timer);
 
 	mod_timer(&dev->mib_read_timer, jiffies + dev->mib_read_interval);
 	schedule_work(&dev->mib_read);
@@ -115,7 +115,7 @@ void ksz_init_mib_timer(struct ksz_device *dev)
 	dev->mib_read_interval = msecs_to_jiffies(30000);
 
 	INIT_WORK(&dev->mib_read, ksz_mib_read_work);
-	setup_timer(&dev->mib_read_timer, mib_monitor, (unsigned long)dev);
+	timer_setup(&dev->mib_read_timer, mib_monitor, 0);
 
 	for (i = 0; i < dev->mib_port_cnt; i++)
 		dev->dev_ops->port_init_cnt(dev, i);
