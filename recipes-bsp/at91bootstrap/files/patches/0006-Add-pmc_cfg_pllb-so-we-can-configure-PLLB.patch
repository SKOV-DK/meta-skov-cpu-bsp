From 166a8e3dbe52198bbbdde6cfa3eec0c5ffc5533a Mon Sep 17 00:00:00 2001
From: Sam Ravnborg <srn@skov.dk>
Date: Sun, 15 Jan 2017 13:15:07 +0100
Subject: [PATCH] Add pmc_cfg_pllb() - so we can configure PLLB

---
 driver/pmc.c  | 12 ++++++++++++
 include/pmc.h |  1 +
 2 files changed, 13 insertions(+)

diff --git a/driver/pmc.c b/driver/pmc.c
index ac8ba48..950cb1b 100644
--- a/driver/pmc.c
+++ b/driver/pmc.c
@@ -165,6 +165,18 @@ int pmc_cfg_plla(unsigned int pmc_pllar)
 	return 0;
 }
 
+int pmc_cfg_pllb(unsigned int pmc_pllbr)
+{
+	/* Always disable PLL before configuring it */
+	write_pmc((unsigned int)PMC_PLLBR, 0 | AT91C_CKGR_SRCA);
+	write_pmc((unsigned int)PMC_PLLBR, pmc_pllbr);
+
+	while (!(read_pmc(PMC_SR) & AT91C_PMC_LOCKB))
+		;
+
+	return 0;
+}
+
 int pmc_cfg_mck(unsigned int pmc_mckr)
 {
 	unsigned int tmp;
diff --git a/include/pmc.h b/include/pmc.h
index 6e0e607..8cbf750 100644
--- a/include/pmc.h
+++ b/include/pmc.h
@@ -38,6 +38,7 @@
 
 extern void pmc_init_pll(unsigned int pmc_pllicpr);
 extern int pmc_cfg_plla(unsigned int pmc_pllar);
+extern int pmc_cfg_pllb(unsigned int pmc_pllbr);
 extern int pmc_cfg_mck(unsigned int pmc_mckr);
 extern int pmc_cfg_mck_down(unsigned int pmc_mckr);
 extern int pmc_cfg_pck(unsigned char x,
-- 
1.8.3.1

