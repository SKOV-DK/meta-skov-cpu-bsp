From: =?UTF-8?q?Ulrich=20=C3=96lmann?= <u.oelmann@pengutronix.de>
Date: Mon, 21 Feb 2022 21:30:36 +0100
Subject: [PATCH] Revert "ARM: boards: skov-imx6: start using deep-probe"
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This reverts commit 472ebb187d55be0819f0f71c6afb27837a4be383.

Barebox' "deep probe" mechanism is under strong suspicion of being responsible
for different issues seen on Skov's imx6 board: no barebox splash screen on HDMI
anymore (runs into timeout after approximately 30 s), bad performance of USB
devices and particularly diverse soft lockups of the running Linux kernel.

Signed-off-by: Ulrich Ã–lmann <u.oelmann@pengutronix.de>
---
 arch/arm/boards/skov-imx6/board.c | 12 ------------
 1 file changed, 12 deletions(-)

diff --git a/arch/arm/boards/skov-imx6/board.c b/arch/arm/boards/skov-imx6/board.c
index 2702bc1de9ac..24bb92e679ce 100644
--- a/arch/arm/boards/skov-imx6/board.c
+++ b/arch/arm/boards/skov-imx6/board.c
@@ -4,7 +4,6 @@
 
 #include <bootsource.h>
 #include <common.h>
-#include <deep-probe.h>
 #include <envfs.h>
 #include <environment.h>
 #include <globalvar.h>
@@ -491,20 +490,10 @@ static int skov_imx6_fixup(struct device_node *root, void *unused)
  */
 static void skov_init_board(const struct board_description *variant)
 {
-	struct device_node *gpio_np = NULL;
 	struct device_node *np;
 	char *environment_path, *envdev;
 	int ret;
 
-	gpio_np = of_find_node_by_name_address(NULL, "gpio@20b4000");
-	if (gpio_np) {
-		ret = of_device_ensure_probed(gpio_np);
-		if (ret)
-			pr_warn("Can't probe GPIO node\n");
-	} else {
-		pr_warn("Can't get GPIO node\n");
-	}
-
 	imx6_bbu_internal_spi_i2c_register_handler("spiflash", "/dev/m25p0.barebox",
 		BBU_HANDLER_FLAG_DEFAULT);
 
@@ -664,7 +653,6 @@ static __maybe_unused struct of_device_id skov_version_ids[] = {
 		/* sentinel */
 	}
 };
-BAREBOX_DEEP_PROBE_ENABLE(skov_version_ids);
 
 static struct driver_d skov_version_driver = {
 	.name = "skov-imx6",
