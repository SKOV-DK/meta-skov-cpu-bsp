#@TYPE: Machine
#@NAME: IMX6
#@DESCRIPTION: Common machine configuration for all IMX6 variants

include conf/machine/include/soc-family.inc

MACHINEOVERRIDES .= ":imx6-cpu"

MACHINE_EXTRA_RRECOMMENDS = " kernel-modules kernel-devicetree \
                              firmware-imx-vpu-imx6d firmware-imx-vpu-imx6q \
"

EXTRA_IMAGECMD:squashfs = "-comp zstd -b 128K -no-xattrs"
EXTRA_IMAGEDEPENDS += "virtual/bootloader"

DEFAULTTUNE = "cortexa9thf-neon"
require conf/machine/include/arm/armv7a/tune-cortexa9.inc

IMAGE_FSTYPES += "tar.bz2 squashfs"

SERIAL_CONSOLES = "115200;ttymxc1"

PREFERRED_PROVIDER:virtual/egl:mx6-generic-bsp  ?= "mesa"
PREFERRED_PROVIDER:virtual/libgl:mx6-generic-bsp  ?= "mesa"
PREFERRED_PROVIDER:virtual/libgles1:mx6-generic-bsp  ?= "mesa"
PREFERRED_PROVIDER:virtual/libgles2:mx6-generic-bsp  ?= "mesa"

PREFERRED_PROVIDER:virtual/wpebackend ?= "wpebackend-fdo"

PREFERRED_PROVIDER:virtual/bootloader ?= "barebox"

PREFERRED_PROVIDER:virtual/kernel ?= "linux-skov"

BAREBOX_IMAGE = "barebox-skov-imx6.img"

KERNEL_IMAGETYPE = "zImage"
KERNEL_DEVICETREE = "\
 imx6dl-skov-revc-lt2.dtb \
 imx6dl-skov-revc-lt6.dtb \
 imx6q-skov-revc-lt2.dtb \
 imx6q-skov-revc-lt6.dtb \
 imx6q-skov-reve-mi1010ait-1cp1.dtb \
 "

MACHINE_FEATURES = "usbgadget usbhost vfat touchscreen serial rtc"

SOC_FAMILY = "mx6"
MACHINE_SOCARCH = "${TUNE_PKGARCH}-mx6"
MACHINE_ARCH_FILTER = "virtual/kernel"
PACKAGE_EXTRA_ARCHS:append = " ${MACHINE_SOCARCH}"

PREFERRED_PROVIDER_virtual/java-native ?= "cacao-native"
PREFERRED_PROVIDER_virtual/java-initial-native ?= "cacao-initial-native"
#TUNE_ARCH = "arm"
#TUNE_PKGARCH = "arm"
