# short-description: Create mostly empty bootable image to flash on an SD-card
# long-description: Creates a GPT partitioned SD-card image with barebox as
# bootloader between MBR and the first partition containing barebox'
# environment. The second partition is filled with the contents of the root-FS
# this WKS file is applied to.
#
# https://docs.yoctoproject.org/dev/ref-manual/kickstart.html#openembedded-kickstart-wks-reference

part barebox --source rawcopy --sourceparams="file=${BAREBOX_IMAGE},skip=${BAREBOX_PADDING_SKIP}" --offset ${BAREBOX_PADDING_OFFSET}k --no-table
part --part-name barebox-environment --part-type ${PART_TYPE_BAREBOX_ENV}    --align 1024 --fixed-size 1M    --source empty
part --part-name system.fit          --part-type ${PART_TYPE_LINUX_RESERVED} --align 1024 --fixed-size 64M   --source rawcopy --sourceparams="file=${FITIMAGE_IMAGE_LINK_NAME}"
part --part-name system.root-FS      --part-type ${PART_TYPE_ROOT_ARM64}     --align 1024 --fixed-size 3685M --source rawcopy --sourceparams="file=${ROOTFS_IMAGE_LINK_NAME}"
part --part-name home                --part-type ${PART_TYPE_HOME}           --align 1024 --fixed-size 64M   --source rootfs  --change-directory home/ --fstype=ext4

bootloader --ptable gpt
