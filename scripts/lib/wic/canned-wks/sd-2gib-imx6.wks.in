# short-description: Create mostly empty bootable image to flash on an SD-card
# long-description: Creates an MBR partitioned SD-card image with barebox as
# bootloader between MBR and the first partition containing barebox'
# environment. The second and third partitions are filled with the contents of
# the root-FS this WKS file is applied to.
#
# https://docs.yoctoproject.org/dev/ref-manual/kickstart.html#openembedded-kickstart-wks-reference

part barebox --source rawcopy --sourceparams="file=${BAREBOX_IMAGE},skip=${BAREBOX_PADDING_SKIP}" --offset ${BAREBOX_PADDING_OFFSET}k --no-table
part       --align 1024 --fixed-size 1M    --source empty
part       --align 1024 --fixed-size 1749M --source rootfs --exclude-path     home/ --fstype=ext4 --label system
part /home --align 1024 --fixed-size 64M   --source rootfs --change-directory home/ --fstype=ext4 --label home   --ondisk mmcblk2 --fsoptions "defaults,rw"

bootloader --ptable msdos
