# short-description: Create mostly empty bootable image to flash on an SD-card
# long-description: Creates a GPT partitioned SD-card image with barebox as
# bootloader between MBR and the first partition containing barebox'
# environment. The second partition is filled with the contents of the root-FS
# this WKS file is applied to.
#
# https://docs.yoctoproject.org/dev/ref-manual/kickstart.html#openembedded-kickstart-wks-reference

# To allow for GPT partitioning for the imx6-cpu do not integrate barebox via
# WIC but postprocess the image (see IMAGE_CMD:append:wic () in common-image-
# append.inc).
#
# part barebox --source rawcopy --sourceparams="file=${BAREBOX_IMAGE},skip=${BAREBOX_PADDING_SKIP}" --offset ${BAREBOX_PADDING_OFFSET}k --no-table

part --part-name barebox-environment --part-type ${PART_TYPE_BAREBOX_ENV} --align 1024 --fixed-size 1M    --source empty
part --part-name system              --part-type ${PART_TYPE_ROOT_ARM}    --align 1024 --fixed-size 1813M --source rootfs --fstype=ext4

bootloader --ptable gpt
