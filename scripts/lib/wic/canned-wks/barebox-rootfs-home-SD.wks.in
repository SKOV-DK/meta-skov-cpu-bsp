# short-description: Create bootable image to flash on an SD-card
# long-description: Creates an MBR partitioned SD-card image with barebox as
# bootloader between MBR and the first partition containing the root-FS, whereas
# the second partition contains the filesystem for /home.

# Dunfell's syntax does not allow for explicit units, the default is kiB for
# offset and MiB for the (fixed) size.
part barebox --source rawcopy --sourceparams="file=${BAREBOX_IMAGE},skip=${BAREBOX_PADDING_SKIP}" --offset ${BAREBOX_PADDING_OFFSET} --no-table
part --label root-FS --fstype=ext4 --align 1024 --source rootfs --exclude-path home/     --offset 1024
part --label home    --fstype=ext4 --align 1024 --source rootfs --change-directory home/ --fixed-size 64

bootloader --ptable msdos
