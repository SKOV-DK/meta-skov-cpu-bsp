# short-description: Create SD image for factory installation
# long-description: Creates a partitioned SD image that is able to factory
# install the eMMC so that it contains barebox' environment & state, two root-FS
# partitions in an A/B setup suitable for usage via RAUC as well as a /home
# partition filling the rest of the eMMC.

# Remember to keep the location of barebox' environment synchronized with the
# redundant information in barebox' devicetree file (imx8mp-evk.dts)!
#
# Dunfell's syntax does not allow for explicit units, the default is kiB for
# offset and MiB for the (fixed) size.
part barebox --source rawcopy --sourceparams="file=${BAREBOX_IMAGE},skip=${BAREBOX_PADDING_SKIP}" --offset ${BAREBOX_PADDING_OFFSET} --no-table
part --offset 1024   --fixed-size 1
part --label root-FS --fstype=ext4 --align 1024 --source rootfs

bootloader --ptable msdos
