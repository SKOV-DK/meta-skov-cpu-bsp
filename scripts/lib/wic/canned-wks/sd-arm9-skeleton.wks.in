# short-description: Create mostly empty ARM9-bootable image to flash on an SD-card
# long-description: Creates an MBR partitioned SD-card image with an ARM9
# compatible bootpartition, a partition filled with the contents of the root-FS
# this WKS file is applied to except its /home which is found in the third
# partition.
#
# https://docs.yoctoproject.org/dev/ref-manual/kickstart.html#openembedded-kickstart-wks-reference

# RomBOOT in the at91sam9263 does not recognize the default FAT partition
# created by mkdosfs. Hence the following options are needed:
#
#   -n BOOT - Set volume label to "BOOT"
#   -F 16   - Force the partition to FAT 16
#   -D 0    - Set drive number to 0
#   -R 1 -a - Reserve only one sector
#
# The combination of "-D 0" AND "-R 1 -a" is required from mkdosfs version 4.1
# onwards.

part --active --fixed-size 16M   --system-id 0x0c --source bootimg-partition --fstype=msdos --label BOOT --mkfs-extraopts="-F 16 -D 0 -R 1 -a"
part          --fixed-size 1500M --system-id 0x83 --source rootfs            --fstype=ext4  --label root --exclude-path     home/
part          --fixed-size 100M  --system-id 0x83 --source rootfs            --fstype=ext4  --label home --change-directory home/

bootloader --ptable msdos
